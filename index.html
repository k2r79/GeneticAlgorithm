<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Genetic Algorithm</title>

    <script src="node_modules/jquery/dist/jquery.min.js"></script>
    <script src="node_modules/underscore/underscore-min.js"></script>
    <script src="js/genetic.js"></script>
    <script src="js/image-lib.js"></script>
</head>
<body>
    <canvas id="canvas" width="300" height="150"></canvas>

    <script>
        var canvas = $("#canvas")[0];
        var context = canvas.getContext("2d");
        var idealImage = new Image();

        var geneticCode = new GeneticCode(canvas.width / 2 * canvas.height);

        $(document).ready(function() {
            drawIdealImage();
            setIdealImage();

            drawGeneticImage();

            geneticCode.live(drawGeneticImage);

            function drawIdealImage() {
                idealImage.onload = function () {
                    context.drawImage(idealImage, 0, 0, canvas.width / 2, canvas.height);
                };

                idealImage.src = "images/minion.jpg";
            }

            function setIdealImage() {
                var binaryImageData = ImageLib.imageDataToBinary(context.getImageData(0, 0, canvas.width / 2, canvas.height).data);

                _.each(geneticCode.ideal, function(chromosome, chromosomeIndex) {
                    var binaryImageDataIndex = chromosomeIndex * 3;

                    chromosome.genes = [
                        binaryImageData[binaryImageDataIndex],
                        binaryImageData[binaryImageDataIndex + 1],
                        binaryImageData[binaryImageDataIndex + 2]
                    ];
                });
            }

            function drawGeneticImage() {
                var geneticImageData = context.createImageData(canvas.width / 2, canvas.height);

                _.each(geneticCode.chromosomes, function(chromosome, chromosomeIndex) {
                    _.each(ImageLib.imageDataToRGBA(chromosome.genes), function(pixel, pixelIndex) {
                        geneticImageData.data[chromosomeIndex * 4 + pixelIndex] = pixel;
                    });
                });

                context.putImageData(geneticImageData, canvas.width / 2, 0);
            }
        });
    </script>
</body>
</html>